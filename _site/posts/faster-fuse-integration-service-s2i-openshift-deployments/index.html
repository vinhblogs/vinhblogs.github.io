<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >
  <link rel="shortcut icon" type="image/png" href="/icon.png" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@koint">
  <meta name="twitter:creator" content="@koint">

  <!-- SEO stuff -->
  <title>Faster Fuse Integration Service 2.0 S2I Openshift Deployments</title>
  <meta property="og:title" content="Faster Fuse Integration Service 2.0 S2I Openshift Deployments" />
  <meta name="twitter:title" content="Faster Fuse Integration Service 2.0 S2I Openshift Deployments">


  
	  <meta name="description" content="Openshift offers a whole pipeline to create container images directly from source code.
It is usable for general purpose Java applications as well as for Fuse Integration Service projects.
This post will present how to accelerate the build time of those images by setting up a local Nexus Repository and configuring application templates
to use this repository for the build process. The idea is not having to download from the Internet all the FIS maven dependencies when building a new project.
At the time of writing FIS 2.0 is available as tech preview." />
	  <meta property="og:description" content="Openshift offers a whole pipeline to create container images directly from source code.
It is usable for general purpose Java applications as well as for Fuse Integration Service projects.
This post will present how to accelerate the build time of those images by setting up a local Nexus Repository and configuring application templates
to use this repository for the build process. The idea is not having to download from the Internet all the FIS maven dependencies when building a new project.
At the time of writing FIS 2.0 is available as tech preview." />
	  <meta name="twitter:description" content="Openshift offers a whole pipeline to create container images directly from source code.
It is usable for general purpose Java applications as well as for Fuse Integration Service projects.
This post will present how to accelerate the build time of those images by setting up a local Nexus Repository and configuring application templates
to use this repository for the build process. The idea is not having to download from the Internet all the FIS maven dependencies when building a new project.
At the time of writing FIS 2.0 is available as tech preview.">
  
  <link rel="canonical" href="http://0.0.0.0:4000/posts/faster-fuse-integration-service-s2i-openshift-deployments/" />
  <meta property="og:url" content="http://0.0.0.0:4000/posts/faster-fuse-integration-service-s2i-openshift-deployments/" />
  <meta name="twitter:url" content="http://0.0.0.0:4000/posts/faster-fuse-integration-service-s2i-openshift-deployments/">

  <meta property="og:site_name" content="Alain's Tech Blog" />
  <meta property="og:image" content="http://0.0.0.0:4000/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/top.jpg" />
  <meta name="twitter:image" content="http://0.0.0.0:4000/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/top.jpg">

   <!-- if it's an article -->
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2017-02-16T06:00:00+07:00" />
  <meta property="article:modified_time" content="2017-02-22T06:00:00+07:00" />

  <meta content="http://www.linkedin.com/in/alainpham" property="article:author">

  
	  
	  <meta content="development" property="article:section">
	  
  

  
	  
	  <meta content="jboss-fuse" property="article:tag">
	  
	  <meta content="fis" property="article:tag">
	  
	  <meta content="openshift" property="article:tag">
	  
	  <meta content="build-time" property="article:tag">
	  
	  <meta content="paas" property="article:tag">
	  
	  <meta content="docker" property="article:tag">
	  
  

    <script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Faster Fuse Integration Service 2.0 S2I Openshift Deployments",
"datePublished": "2017-02-16T06:00:00+07:00",
  
"description": "
Openshift offers a whole pipeline to create container images directly from source code.
It is usable for general purpose Java applications as well as for Fuse Integration Service projects.
This post will present how to accelerate the build time of those images by setting up a local Nexus Repository and configuring application templates
to use this repository for the build process. The idea is not having to download from the Internet all the FIS maven dependencies when building a new project.
At the time of writing FIS 2.0 is available as tech preview.



",
  
"url": "http://0.0.0.0:4000/posts/faster-fuse-integration-service-s2i-openshift-deployments/"}</script>

  

  <link rel="author" href="http://www.linkedin.com/in/alainpham"/>

   <!-- End SEO stuff -->

  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/assets/css/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" href="/assets/css/main.css" />
   <link href="/assets/css/syntax.css" rel="stylesheet">

  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>

</head>

<body>
	<div>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button class="navbar-toggle collapsed" type="button"
					data-toggle="collapse" data-target="#navbar-collapse-menu">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"> <i class="fa fa-barcode"></i>
				</a>
			</div>
			<div id="navbar-collapse-menu" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">

					
						<!-- If has submenues -->
						
						<li class="dropdown">
							<a class="dropdown-toggle"	data-toggle="dropdown" href="#">
								Featured Projects
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								
									<li>
										<a href="/projects/microbam">
											
											MicroBam
										</a>
									</li>
								
									<li>
										<a href="/projects/ourlegacy">
											
											OurLegacy
										</a>
									</li>
								
								</ul>
							</li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/">Posts</a></li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/tags">Tags</a></li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/about">About</a></li>
						
					
						<!-- If has submenues -->
						
						<li class="dropdown">
							<a class="dropdown-toggle"	data-toggle="dropdown" href="#">
								Follow me
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								
									<li>
										<a href="http://github.com/alainpham">
											
											<i class="fa fa-inverse fa-github fa-2x"></i>
											
											GitHub
										</a>
									</li>
								
									<li>
										<a href="http://www.linkedin.com/in/alainpham">
											
											<i class="fa fa-inverse fa-linkedin-square fa-2x"></i>
											
											LinkedIn
										</a>
									</li>
								
									<li>
										<a href="https://twitter.com/koint">
											
											<i class="fa fa-inverse fa-twitter fa-2x"></i>
											
											Twitter
										</a>
									</li>
								
								</ul>
							</li>
						
					
				</ul>
			</div>
		</div>
	</nav>
		
		<img
			alt="Faster Fuse Integration Service 2.0 S2I Openshift Deployments"
			src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/top.jpg" class="img-responsive">
		

	<div class="jumbotron  clearfix">

		<h1 class="text-center">Faster Fuse Integration Service 2.0 S2I Openshift Deployments</h1>

	</div>
</div>

	<div class="container">

	
	<p>
		<strong>February 16, 2017</strong> ( last updated : February 22, 2017 )
		<br>
		
			<a class="label label-default" href="/tags/#jboss-fuse">jboss-fuse</a>
		
			<a class="label label-default" href="/tags/#fis">fis</a>
		
			<a class="label label-default" href="/tags/#openshift">openshift</a>
		
			<a class="label label-default" href="/tags/#build-time">build-time</a>
		
			<a class="label label-default" href="/tags/#paas">paas</a>
		
			<a class="label label-default" href="/tags/#docker">docker</a>
		
    </p>
	
	<p>
    	<a href="https://github.com/alainpham/fis20-simple-svc" class="btn btn-default">
		    <i class="fa fa-github fa-2x"></i>  https://github.com/alainpham/fis20-simple-svc
			</a>
	</p>
	
	<hr>
	<h1>Abstract</h1>
	

	<p>
Openshift offers a whole pipeline to create container images directly from source code.
It is usable for general purpose Java applications as well as for Fuse Integration Service projects.
This post will present how to accelerate the build time of those images by setting up a local Nexus Repository and configuring application templates
to use this repository for the build process. The idea is not having to download from the Internet all the FIS maven dependencies when building a new project.
At the time of writing FIS 2.0 is available as tech preview.
</p>
<!--more-->

<p>(update 22/02/2017) February 21, 2017 : FIS 2.0 GA has been released.</p>
<p>The method shown here doesn't use the MVN_MIRROR_URL parameter which was enabled in FIS 2.0.
This will work on FIS 2.0 and also FIS 1.0.
</p>

<h2>Prerequisites</h2>
<ul>
	<li>Openshift installed</li>
	<li>JDK 1.8+ installed</li>
	<li>Maven 3.3+ installed</li>
</ul>

<h2>
Setting up a Nexus repository
</h2>
<p>The reason why build times can be long with the source S2I pipeline is because each new application build requires to spin up a
S2I container to launch the maven goals in order to package your application.
Building the same application template after the first time is faster because the downloaded artifacts are reused.
But every time we create a new application, it will go through the same initial downloading process again.
That is why instead of having the S2I container download everything from Internet repositories each time,
we can setup a Nexus server that will proxy these repositories and store already downloaded artifacts locally.
Here we will show how to setup a local standalone Nexus2 repository
</p>

<a href="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_s2i.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_s2i.png" alt="nexus s2i architecture"/></a>

<h3>Download Nexus 2 OSS and run it</h3>
<p>
Download the Nexus Repository Manager OSS 2.x package on :
<a href="https://www.sonatype.com/download-oss-sonatype">https://www.sonatype.com/download-oss-sonatype</a>
</p>
<p>
Unzip it and run it :
</p>

<pre>
./nexus console
</pre>

<h3>Setup proxy for Red Hat GA and Early Access repositories</h3>
<p>Connect to the user interface with the user and password admin/admin123</p>

<pre>
http://localhost:8081/nexus
</pre>
<p>
<a href="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/login_nexus.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/login_nexus.png" alt="nexus login page"/></a>
</p>
<p>
Click on Repositories and add 3 new proxy repositories
</p>
	<ul>
		<li>
			The Red Hat GA repository (jboss-ga-repository) : https://maven.repository.redhat.com/ga/
		</li>
		<li>
			The Red Hat Early Access repository (jboss-ea-repository) : https://maven.repository.redhat.com/earlyaccess/all
		</li>
		<li>
			The Fuse source repo eventually for older versions of Fuse (fuse-source) : https://repo.fusesource.com/nexus/content/groups/public/
		</li>
	</ul>


<p>
<a href="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_proxy_repo.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_proxy_repo.png" alt="setup nexus proxy repos"/></a>
</p>

<h3>Setup public group for all proxy repositories</h3>
<p>Select the public group, add all the created proxy repositories and maven central.</p>
<p>
<a href="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_public_group.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/nexus_public_group.png" alt="setup nexus public group"/></a>
</p>

<p>
That's it, you have successfully setup your local Maven repository that will keep a local copy of all downloaded artifacts.
</p>

<h2>
Create a Fuse project with the Java Spring Boot archetype for Openshift
</h2>

<p>
Now in order to test a deployment let's create a Fuse project. Before we begin make sure that you have these prerequisites
on your developer machine :
</p>
<ul>
<li>JDK 1.7+ installed</li>
<li>Maven installed</li>
</ul>


<h3>Configure maven settings</h3>

<p>
Make sure to configure your maven settings.xml file and add the Red Hat GA and Early access repositories to it.
</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;profile&gt;</span>
  <span class="nt">&lt;id&gt;</span>rh-repos<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;repositories&gt;</span>
	<span class="c">&lt;!-- EARLY ACCESS RH--&gt;</span>
	<span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>jboss-ea-repository<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://maven.repository.redhat.com/earlyaccess/all<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

	<span class="c">&lt;!-- Global Availability RH--&gt;</span>
      <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>jboss-ga-repository<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://maven.repository.redhat.com/ga/<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

    <span class="c">&lt;!-- Fuse Source GA--&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>fuse-source<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
      <span class="nt">&lt;name&gt;</span>FuseSource Release Repository<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;url&gt;</span>http://repo.fusesource.com/nexus/content/repositories/releases<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>


  <span class="nt">&lt;pluginRepositories&gt;</span>
	<span class="c">&lt;!-- EARLY ACCESS RH--&gt;</span>
	<span class="nt">&lt;pluginRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>jboss-ea-plugin-repository<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://maven.repository.redhat.com/earlyaccess/all<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/pluginRepository&gt;</span>

	<span class="c">&lt;!-- Global Availability RH--&gt;</span>
    <span class="nt">&lt;pluginRepository&gt;</span>
       <span class="nt">&lt;id&gt;</span>jboss-ga-plugin-repository<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://maven.repository.redhat.com/ga/<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/pluginRepository&gt;</span>

    <span class="c">&lt;!-- Fuse Source GA--&gt;</span>
    <span class="nt">&lt;pluginRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>fusesource-plugin<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;releases&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
        <span class="nt">&lt;updatePolicy&gt;</span>never<span class="nt">&lt;/updatePolicy&gt;</span>
      <span class="nt">&lt;/releases&gt;</span>
      <span class="nt">&lt;snapshots&gt;</span>
        <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
      <span class="nt">&lt;/snapshots&gt;</span>
      <span class="nt">&lt;name&gt;</span>FuseSource Release Repository<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;url&gt;</span>http://repo.fusesource.com/nexus/content/repositories/releases<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/pluginRepository&gt;</span>
  <span class="nt">&lt;/pluginRepositories&gt;</span>

<span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>


<span class="nt">&lt;activeProfiles&gt;</span>
 <span class="nt">&lt;activeProfile&gt;</span>rh-repos<span class="nt">&lt;/activeProfile&gt;</span>
<span class="nt">&lt;/activeProfiles&gt;</span></code></pre></figure>


<h3>Create a FIS Spring Boot project</h3>

<pre>
mvn archetype:generate \
 -DarchetypeCatalog=https://maven.repository.redhat.com/ga/io/fabric8/archetypes/archetypes-catalog/2.2.195.redhat-000004/archetypes-catalog-2.2.195.redhat-000004-archetype-catalog.xml  \
 -DarchetypeGroupId=org.jboss.fuse.fis.archetypes  \
 -DarchetypeArtifactId=spring-boot-camel-xml-archetype  \
 -DarchetypeVersion=2.2.195.redhat-000004
</pre>

<h3>Add necessary dependencies to the pom.xml</h3>

<p>
Add these dependencies to the pom.xml file in order to create a JSON Rest Webservice.
</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-jetty<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-jackson<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<h3>Create routes to expose a rest webservice</h3>

<p>Open the camel-context.xml file to create the following RestConfigurations and routes.</p>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;camelContext</span> <span class="na">xmlns=</span><span class="s">"http://camel.apache.org/schema/spring"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;restConfiguration</span> <span class="na">bindingMode=</span><span class="s">"json"</span> <span class="na">component=</span><span class="s">"jetty"</span> <span class="na">enableCORS=</span><span class="s">"true"</span>
		<span class="na">host=</span><span class="s">"0.0.0.0"</span> <span class="na">port=</span><span class="s">"8666"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;rest</span> <span class="na">id=</span><span class="s">"svc"</span> <span class="na">path=</span><span class="s">"/"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;get</span> <span class="na">id=</span><span class="s">"testOp"</span> <span class="na">uri=</span><span class="s">"test"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;to</span> <span class="na">uri=</span><span class="s">"direct:test"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/get&gt;</span>
	<span class="nt">&lt;/rest&gt;</span>
	<span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"testRoute"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;from</span> <span class="na">id=</span><span class="s">"testStarter"</span> <span class="na">uri=</span><span class="s">"direct:test"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;log</span> <span class="na">message=</span><span class="s">"received request"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;setBody&gt;</span>
			<span class="nt">&lt;constant&gt;</span>Hello world<span class="nt">&lt;/constant&gt;</span>
		<span class="nt">&lt;/setBody&gt;</span>
	<span class="nt">&lt;/route&gt;</span>
<span class="nt">&lt;/camelContext&gt;</span></code></pre></figure>

<p>To avoid a tcp port conflict with the default Nexus port (8081), make sure to change the parameter "management.port" in
the resources/application.properties file. You can change it to 8086 for example.</p>

<p>Run the project locally to see if everything is fine. Go to the root folder of your project.</p>
<pre>mvn spring-boot:run</pre>

<p>Call the service using a browser/</p>
<pre>http://localhost:8666/test</pre>

<h3>
Create a settings.xml file
</h3>

<p>At the root of your project copy your current maven settings.xml file
(the one with all the repositories defined) and add a mirror bloc as follows.
This will be used later by Openshift S2I. It there to configure Maven to get artifacts from your local Nexus repository.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"> <span class="nt">&lt;mirrors&gt;</span>
   <span class="nt">&lt;mirror&gt;</span>
     <span class="nt">&lt;id&gt;</span>internal-repository<span class="nt">&lt;/id&gt;</span>
     <span class="nt">&lt;name&gt;</span>Maven Repository Manager running on repo.mycompany.com<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;url&gt;</span>${MVN_MIRROR}<span class="nt">&lt;/url&gt;</span>
     <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
   <span class="nt">&lt;/mirror&gt;</span>
 <span class="nt">&lt;/mirrors&gt;</span></code></pre></figure>

<h2>Deploy on Openshift using S2i</h2>

<p>Connect to your Openshift instance using the "oc" command</p>
<pre>oc login -u developer</pre>

<h3>Import the FIS 2.0 image streams</h3>
<pre>
wget raw.githubusercontent.com/jboss-fuse/application-templates/application-templates-2.0.redhat-000026/fis-image-streams.json
oc create -f fis-image-streams.json
</pre>

<h3>Create an application template YAML file</h3>
<p>This is a very crucial step. Here we will tweak the application template json/yml file so that
the S2I takes into account the Nexus repository for the Maven build.</p>

<p>Get the template json file for FIS Spring-Boot applications. Optionally you can convert the json to a yml file which I find easier to read.</p>
<pre>
wget https://raw.githubusercontent.com/jboss-fuse/application-templates/application-templates-2.0.redhat-000026/quickstarts/springboot-camel-template.json
</pre>

<p>The important parameters to change in the template are the following.
</p>
<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">APP_NAME</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Application Name</span>
  <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s">springboot-rest</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">The name assigned to the application.</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">GIT_REPO</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Git Repository URL</span>
  <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s">https://github.com/alainpham/fis20-simple-svc.git</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">The URL of the repository with your application source code.</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">GIT_REF</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Git Reference</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s">master</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Set this to a branch name, tag or other ref of your repository if you</span>
    <span class="s">are not using the default branch.</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">APP_VERSION</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Application Version</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s">0.0.1</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">IMAGE_STREAM_NAMESPACE</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Image Stream Namespace</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
  <span class="na">required</span><span class="pi">:</span> <span class="no">false</span></code></pre></figure>

<p>The most important change is the following MAVEN_ARGS parameter. It is where we point to the Nexus repo we created and where we use
the settings.xml file at to root of the project.
Note that the IP address here 172.17.0.1 is the one that belongs to the host machine bound to the docker network interface. Adapt
it to your situation if necessary.</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MAVEN_ARGS</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Maven Arguments</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s">package -DMVN_MIRROR=http://172.17.0.1:8081/nexus/content/groups/public/ -gs settings.xml -DskipTests -Dfabric8.skip -e -B</span></code></pre></figure>

<p>You should also add the following parameter to tweak the heap size of the JVM used for the maven build. In some rare cases you could run into an out of heap space exception.
It is always good to keep control over this parameter.</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MAVEN_OPTS</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">maven options such as heapspace</span>
  <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-Xmx1024m"</span></code></pre></figure>

<p>Add the environment parameter MAVEN_OPTS in the sourceStrategy bloc of the buildConfig so it is taken into account in the Maven command</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">sourceStrategy</span><span class="pi">:</span>
  <span class="na">from</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">ImageStreamTag</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${IMAGE_STREAM_NAMESPACE}"</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">fis-java-openshift:${BUILDER_VERSION}</span>
  <span class="na">forcePull</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">incremental</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">env</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BUILD_LOGLEVEL</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5'</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ARTIFACT_DIR</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${ARTIFACT_DIR}"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MAVEN_ARGS</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${MAVEN_ARGS}"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MAVEN_ARGS_APPEND</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${MAVEN_ARGS_APPEND}"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MAVEN_OPTS</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s">${MAVEN_OPTS}</span></code></pre></figure>

<p>We should also add the service and routes to expose the Rest service to the external world</p>
<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
    <span class="na">creationTimestamp</span><span class="pi">:</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">group</span><span class="pi">:</span> <span class="s">quickstarts</span>
      <span class="na">project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">provider</span><span class="pi">:</span> <span class="s">s2i</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_VERSION}"</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">rest-svc-tcp</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8666</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8666</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">deploymentconfig</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">group</span><span class="pi">:</span> <span class="s">quickstarts</span>
      <span class="na">project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">provider</span><span class="pi">:</span> <span class="s">s2i</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_VERSION}"</span>
    <span class="na">sessionAffinity</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
  <span class="na">status</span><span class="pi">:</span>
    <span class="na">loadBalancer</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Route</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
    <span class="na">creationTimestamp</span><span class="pi">:</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">group</span><span class="pi">:</span> <span class="s">quickstarts</span>
      <span class="na">project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
      <span class="na">provider</span><span class="pi">:</span> <span class="s">s2i</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_VERSION}"</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">to</span><span class="pi">:</span>
      <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${APP_NAME}"</span>
    <span class="na">port</span><span class="pi">:</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">rest-svc-tcp</span>
  <span class="na">status</span><span class="pi">:</span> <span class="pi">{}</span></code></pre></figure>

<p>This is the final file I have used : </p>
<pre>
wget https://raw.githubusercontent.com/alainpham/fis20-simple-svc/v1.0/openshift/solution.yml
</pre>

<p>The working project with all the resources can be found here : </p>
<a href="https://github.com/alainpham/fis20-simple-svc">https://github.com/alainpham/fis20-simple-svc</a>

<h3>Deploy and run the application</h3>
<p>You can use the command line. Alternatively you can use the Openshift UI to import the application template and deploy it.</p>
<pre>
oc create -f solution.yml
oc create oc new-app springboot-rest
</pre>

<a href="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/faster_build.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/faster-fuse-integration-service-s2i-openshift-deployments/faster_build.png" alt="openshift s2i faster build times"/></a>

<p>Test your service at the following url</p>
<pre>
http://springboot-rest-myproject.[yourIP].xip.io/test
</pre>

<p>Note that the build takes only about 2 minute the second time you run it instead of 20 minutes (in my case with a not so fast internet connection). This is thanks to the fact that the maven dependencies are
taken from the local Nexus instead of being downloaded from the Internet.</p>



<strong>
Other resources :
</strong>
<ul>
<li>Video tutorial showing the source S2I method for FIS 2.0 : <a href="https://vimeo.com/194416659">https://vimeo.com/194416659</a></li>

<li>Tutorial with binary S2I method (fabric8 plugin) : <a href="https://developers.redhat.com/blog/2017/01/17/getting-started-with-fuse-integration-service-2-0-tech-preview/">Getting Started with Fuse Integration Service 2.0 Tech preview</a></li>
<li>(update 22/02/2017)Official FIS 2.0 GA documentation : <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_jboss_fuse_integration_services_2.0_for_openshift/">https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_jboss_fuse_integration_services_2.0_for_openshift/</a></li>
</ul>



	
	<p>Originally published February 16, 2017
    <br> Latest update February 22, 2017</p>

    <p><strong>Related posts :</strong></p>
        <ul>
	    
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  <li>
			      <a href="/posts/openshift-quickstart-in-5-minutes/">
			        Openshift Quickstart in 5 minutes
			      </a>
			  </li>
			  
		
			  
			  
			  <li>
			      <a href="/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/">
			        Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries
			      </a>
			  </li>
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  <li>
			      <a href="/posts/handling-large-streams-of-data-through-http-with-jboss-fuse/">
			        Handling Large Streams of Data through HTTP with JBoss Fuse
			      </a>
			  </li>
			  
		
			  
			  
			  <li>
			      <a href="/posts/ansible-automation-for-highly-available-jboss-fuse-amq-integration-platform/">
			        Ansible Automation for Highly Available JBoss Fuse/A-MQ Integration Platform
			      </a>
			  </li>
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
		</ul>
	

	
	
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://alainpham.github.io/posts/faster-fuse-integration-service-s2i-openshift-deployments/";  // Replace PAGE_URL with your page's canonical URL variable
//this.page.identifier = "/posts/faster-fuse-integration-service-s2i-openshift-deployments"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//apham.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
	</div>
	<footer class="footer">
	<ul class="footer-links">
		<li><a href="http://github.com/alainpham"> <i
				class="fa fa-inverse fa-github fa-3x"></i></a></li>
		<li><a href="http://www.linkedin.com/in/alainpham"> <i
				class="fa fa-inverse fa-linkedin-square fa-3x"></i></a></li>
		<li><a href="https://twitter.com/koint"> <i
				class="fa fa-inverse fa-twitter fa-3x"></i></a></li>
	</ul>
</footer>
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>

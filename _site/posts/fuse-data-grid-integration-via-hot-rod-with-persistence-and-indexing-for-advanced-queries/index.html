<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >
  <link rel="shortcut icon" type="image/png" href="/icon.png" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@koint">
  <meta name="twitter:creator" content="@koint">

  <!-- SEO stuff -->
  <title>Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries</title>
  <meta property="og:title" content="Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries" />
  <meta name="twitter:title" content="Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries">


  
	  <meta name="description" content="Building Integration and Services platform with JBoss Fuse is great.
It is even better when you add a distributed in memory data base solution such as JBoss Data Grid to the mix.
This article will show how to make both technologies work together using the camel-jbossdatagrid component.
We will go through the setup of a JBoss Data Grid server with persistence and see how to use it in a JBoss Fuse application through the remote Hot Rod client.
Furthermore we will see how to take advantage of Protocol buffers and Lucene to index data and perform content based queries." />
	  <meta property="og:description" content="Building Integration and Services platform with JBoss Fuse is great.
It is even better when you add a distributed in memory data base solution such as JBoss Data Grid to the mix.
This article will show how to make both technologies work together using the camel-jbossdatagrid component.
We will go through the setup of a JBoss Data Grid server with persistence and see how to use it in a JBoss Fuse application through the remote Hot Rod client.
Furthermore we will see how to take advantage of Protocol buffers and Lucene to index data and perform content based queries." />
	  <meta name="twitter:description" content="Building Integration and Services platform with JBoss Fuse is great.
It is even better when you add a distributed in memory data base solution such as JBoss Data Grid to the mix.
This article will show how to make both technologies work together using the camel-jbossdatagrid component.
We will go through the setup of a JBoss Data Grid server with persistence and see how to use it in a JBoss Fuse application through the remote Hot Rod client.
Furthermore we will see how to take advantage of Protocol buffers and Lucene to index data and perform content based queries.">
  
  <link rel="canonical" href="http://0.0.0.0:4000/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/" />
  <meta property="og:url" content="http://0.0.0.0:4000/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/" />
  <meta name="twitter:url" content="http://0.0.0.0:4000/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/">

  <meta property="og:site_name" content="Alain's Tech Blog" />
  <meta property="og:image" content="http://0.0.0.0:4000/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/top.jpg" />
  <meta name="twitter:image" content="http://0.0.0.0:4000/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/top.jpg">

   <!-- if it's an article -->
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2017-04-07T06:00:00+07:00" />
  <meta property="article:modified_time" content="2017-04-07T06:00:00+07:00" />

  <meta content="http://www.linkedin.com/in/alainpham" property="article:author">

  
	  
	  <meta content="development" property="article:section">
	  
  

  
	  
	  <meta content="jboss-fuse" property="article:tag">
	  
	  <meta content="data-grid" property="article:tag">
	  
	  <meta content="hot-rod" property="article:tag">
	  
	  <meta content="protobuf" property="article:tag">
	  
	  <meta content="lucene" property="article:tag">
	  
  

    <script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries",
"datePublished": "2017-04-07T06:00:00+07:00",
  
"description": "
Building Integration and Services platform with JBoss Fuse is great.
It is even better when you add a distributed in memory data base solution such as JBoss Data Grid to the mix.
This article will show how to make both technologies work together using the camel-jbossdatagrid component.
We will go through the setup of a JBoss Data Grid server with persistence and see how to use it in a JBoss Fuse application through the remote Hot Rod client.
Furthermore we will see how to take advantage of Protocol buffers and Lucene to index data and perform content based queries.



",
  
"url": "http://0.0.0.0:4000/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/"}</script>

  

  <link rel="author" href="http://www.linkedin.com/in/alainpham"/>

   <!-- End SEO stuff -->

  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/assets/css/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" href="/assets/css/main.css" />
   <link href="/assets/css/syntax.css" rel="stylesheet">

  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>

</head>

<body>
	<div>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button class="navbar-toggle collapsed" type="button"
					data-toggle="collapse" data-target="#navbar-collapse-menu">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"> <i class="fa fa-barcode"></i>
				</a>
			</div>
			<div id="navbar-collapse-menu" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">

					
						<!-- If has submenues -->
						
						<li class="dropdown">
							<a class="dropdown-toggle"	data-toggle="dropdown" href="#">
								Featured Projects
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								
									<li>
										<a href="/projects/microbam">
											
											MicroBam
										</a>
									</li>
								
									<li>
										<a href="/projects/ourlegacy">
											
											OurLegacy
										</a>
									</li>
								
								</ul>
							</li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/">Posts</a></li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/tags">Tags</a></li>
						
					
						<!-- If has submenues -->
						
							<li><a href="/about">About</a></li>
						
					
						<!-- If has submenues -->
						
						<li class="dropdown">
							<a class="dropdown-toggle"	data-toggle="dropdown" href="#">
								Follow me
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								
									<li>
										<a href="http://github.com/alainpham">
											
											<i class="fa fa-inverse fa-github fa-2x"></i>
											
											GitHub
										</a>
									</li>
								
									<li>
										<a href="http://www.linkedin.com/in/alainpham">
											
											<i class="fa fa-inverse fa-linkedin-square fa-2x"></i>
											
											LinkedIn
										</a>
									</li>
								
									<li>
										<a href="https://twitter.com/koint">
											
											<i class="fa fa-inverse fa-twitter fa-2x"></i>
											
											Twitter
										</a>
									</li>
								
								</ul>
							</li>
						
					
				</ul>
			</div>
		</div>
	</nav>
		
		<img
			alt="Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries"
			src="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/top.jpg" class="img-responsive">
		

	<div class="jumbotron  clearfix">

		<h1 class="text-center">Fuse Data Grid Integration via Hot Rod with Persistence and Indexing for Advanced Queries</h1>

	</div>
</div>

	<div class="container">

	
	<p>
		<strong>April 07, 2017</strong> ( last updated : April 07, 2017 )
		<br>
		
			<a class="label label-default" href="/tags/#jboss-fuse">jboss-fuse</a>
		
			<a class="label label-default" href="/tags/#data-grid">data-grid</a>
		
			<a class="label label-default" href="/tags/#hot-rod">hot-rod</a>
		
			<a class="label label-default" href="/tags/#protobuf">protobuf</a>
		
			<a class="label label-default" href="/tags/#lucene">lucene</a>
		
    </p>
	
	<p>
    	<a href="https://github.com/alainpham/techlab-fuse-jdg-simple-hotrod" class="btn btn-default">
		    <i class="fa fa-github fa-2x"></i>  https://github.com/alainpham/techlab-fuse-jdg-simple-hotrod
			</a>
	</p>
	
	<hr>
	<h1>Abstract</h1>
	

	<p>
Building Integration and Services platform with JBoss Fuse is great.
It is even better when you add a distributed in memory data base solution such as JBoss Data Grid to the mix.
This article will show how to make both technologies work together using the camel-jbossdatagrid component.
We will go through the setup of a JBoss Data Grid server with persistence and see how to use it in a JBoss Fuse application through the remote Hot Rod client.
Furthermore we will see how to take advantage of Protocol buffers and Lucene to index data and perform content based queries.
</p>
<!--more-->

<p>In the example, we will buil rest services to store and retrieve some business events.</p>

<a href="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/diag.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/diag.png" alt="fuse data grid remote server architecture"/></a>

<p>In summary the steps in this tutorial are the following :</p>

<ul>
	<li>Create an empty Fuse project in JBoss Developer Studio with Spring DSL</li>
	<li>Add necessary dependencies to the pom.xml file</li>
	<li>On the Data Grid server, configure a cache called "event" with an index (Lucene) and a cache store (H2 database as an example)</li>
	<li>Launch an instance of H2 database and Data Grid Server</li>
	<li>Create an POJO as a model of an event</li>
	<li>Annotate the POJO with protobuf annotations to specify which fields should be indexed for queries</li>
	<li>Create basic generic camel routes for getting and putting events into the cache</li>
	<li>Create a query service with dynamic parameters</li>
	<li>Test the services</li>
	<li>Deploy the service on a Fuse Server</li>
</ul>

<h2>Prerequisites</h2>
<ul>
	<li>JDK 1.8+ installed <br>
		<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
		">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
		</a>
	</li>
	<li>Maven 3.3+ installed <br>
<a href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a>
	</li>
</ul>

<h2>Versions used</h2>
<ul>
	<li>JBoss Fuse 6.3.x <br>
<a href="https://developers.redhat.com/products/fuse/download/">https://developers.redhat.com/products/fuse/download/</a>
	</li>
	<li>JBoss Developer Studio Integration Stack 10.1.0 (optional)<br>
<a href="https://developers.redhat.com/products/fuse/download/">https://developers.redhat.com/products/fuse/download/</a>
	</li>
	<li>JBoss Data Grid Server 6.5.x <br>
		<a href="https://developers.redhat.com/products/datagrid/download/">https://developers.redhat.com/products/datagrid/download/</a>
	</li>
	<li>Swagger UI (optional)<br>
		<a href="https://github.com/swagger-api/swagger-ui/archive/v2.2.10.zip">https://github.com/swagger-api/swagger-ui/archive/v2.2.10.zip
		</a>
	</li>
</ul>
<p></p>
<h2>
Access modes to JBoss Data Grid
</h2>
<p>JBoss Data Grid can be accessed through 2 different modes : Library Mode and Server Mode.
<p>
In Server Mode, Data Grid is installed as a distant server and Fuse gets access to the objects through the Hot Rod client.
</p>
<p>
In library mode (or embedded), the Fuse engine uses it's own JVM memory to contain objects that is part of the Data Grid.
In other words the Fuse engine acts as if it was a node amongst the Data Grid cluster.
This mode gives access to advanced features such as transactions and locking and is actually quite easy to setup.
The down side is that it is not possible to perform queries with the infinispan-embedded-query library with Fuse in a Karaf container.
The main reason is that infinispan-embedded-query includes full dependencies to libraries such as hibernate. Hence it is not suited for an OSGI container such as Karaf.
</p>
<p>
In this article we will explore the possibilities of the Server Mode with the Hot Rod client. The Library Mode will be discussed in an other article.
</p>

<h2>
Create a Fuse project
</h2>
<ul>
	<li>Start by creating a Fuse project with a Spring Camel Context in JBoss Developer Studio
		(Alternatively it can also be created with a maven archetype via command line)</li>
	<li>In JBoss Developer Studio go to files -> New -> Fuse Integration Project </li>
	<li>Name the project techlab-fuse-jdg-simple-hotrod</li>
	<li>Select runtime version 2.17.0.redhat-630224</li>
	<li>Start an empty project with Spring DSL</li>
	<li>Click finish</li>
</ul>
<p>
<a href="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/selectversion.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/selectversion.png" alt="select version when creatting Fuse project"/></a>
</p>
<p>
<a href="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/selectemptyandspring.png"> <img
		class="center-block img-responsive"
		src="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/selectemptyandspring.png" alt="select emptu spring when creating Fuse project"/></a>
</p>

<h2>
Edit information and dependencies in pom.xml file
</h2>
<ul>
	<li>Change group id, artifact id to identify the project</li>
	<li>Add dependency to <strong>camel-jbossdatagrid</strong> component  : this enables invocation of Data Grid endpoints in a Camel route <br>
Note that the version should match the version of the Data Grid Server.
	</li>
	<li>Add dependency to <strong>h2</strong> : as an example of cache store we are using an H2 database</li>
	<li>Add dependency to <strong>camel-netty4-http, camel-swagger-java, camel-jackson</strong> : will be used to expose rest services to access the objects stored in the cache</li>
</ul>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-jbossdatagrid<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>6.5.1.Final-redhat-1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-netty4-http<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-swagger-java<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.camel<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>camel-jackson<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<h2>Cache Container configuration on Data Grid Server</h2>
<ul>
	<li>In the Data Grid installation folder, open the file standalone/configuration/standalone.xml</li>
	<li>In the xml file, declare a cache named "event"</li>
	<li>Configure a persistence cache store so that events can survive a server reboot. As an example here we will use an H2 Database.</li>
	<li>Activate indexing to enable advanced queries using the Lucene engine</li>
	<li>Configure eviction so that objects get unloaded from memory when not used. This is to avoid running out of memory.
		Evicted entries stay in the cache store and can be reloaded when needed</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;server</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:1.6"</span><span class="nt">&gt;</span>
	...
   <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:datasources:1.2"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;datasources&gt;</span>
         <span class="nt">&lt;datasource</span> <span class="na">jndi-name=</span><span class="s">"java:jboss/datasources/JdbcDS"</span> <span class="na">pool-name=</span><span class="s">"JdbcDS"</span> <span class="na">enabled=</span><span class="s">"true"</span> <span class="na">use-java-context=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;connection-url&gt;</span>jdbc:h2:tcp://localhost:8942/dgdb<span class="nt">&lt;/connection-url&gt;</span>
            <span class="nt">&lt;driver&gt;</span>h2<span class="nt">&lt;/driver&gt;</span>
            <span class="nt">&lt;security&gt;</span>
               <span class="nt">&lt;user-name&gt;</span>sa<span class="nt">&lt;/user-name&gt;</span>
               <span class="nt">&lt;password</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/security&gt;</span>
         <span class="nt">&lt;/datasource&gt;</span>
         <span class="nt">&lt;drivers&gt;</span>
            <span class="nt">&lt;driver</span> <span class="na">name=</span><span class="s">"h2"</span> <span class="na">module=</span><span class="s">"com.h2database.h2"</span><span class="nt">&gt;</span>
               <span class="nt">&lt;xa-datasource-class&gt;</span>org.h2.jdbcx.JdbcDataSource<span class="nt">&lt;/xa-datasource-class&gt;</span>
            <span class="nt">&lt;/driver&gt;</span>
         <span class="nt">&lt;/drivers&gt;</span>
      <span class="nt">&lt;/datasources&gt;</span>
   <span class="nt">&lt;/subsystem&gt;</span>
   <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:infinispan:server:core:6.3"</span> <span class="na">default-cache-container=</span><span class="s">"local"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;cache-container</span> <span class="na">name=</span><span class="s">"local"</span> <span class="na">default-cache=</span><span class="s">"default"</span> <span class="na">statistics=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        ...
         <span class="nt">&lt;local-cache</span> <span class="na">name=</span><span class="s">"event"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;eviction</span> <span class="na">strategy=</span><span class="s">"LRU"</span> <span class="na">max-entries=</span><span class="s">"50"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- At most we have 50 entries in the cache by evicting [l]east-[r]ecently-[u]sed--&gt;</span>
            <span class="nt">&lt;indexing</span> <span class="na">index=</span><span class="s">"LOCAL"</span><span class="nt">&gt;</span> <span class="c">&lt;!-- Indexing is activated to be stored localy only --&gt;</span>
               <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"default.directory_provider"</span><span class="nt">&gt;</span>filesystem<span class="nt">&lt;/property&gt;</span>
               <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"default.indexBase"</span><span class="nt">&gt;</span>ispn_index<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;/indexing&gt;</span>
            <span class="c">&lt;!-- A mixed store is created to be able to contain entries with string keys and also binary keys --&gt;</span>
            <span class="nt">&lt;mixed-keyed-jdbc-store</span> <span class="na">datasource=</span><span class="s">"java:jboss/datasources/JdbcDS"</span> <span class="na">passivation=</span><span class="s">"false"</span> <span class="na">preload=</span><span class="s">"true"</span> <span class="na">purge=</span><span class="s">"false"</span><span class="nt">&gt;</span>
               <span class="nt">&lt;binary-keyed-table</span> <span class="na">prefix=</span><span class="s">"ISPN_MIX_BKT"</span> <span class="na">create-on-start=</span><span class="s">"true"</span> <span class="na">drop-on-exit=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;id-column</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
                  <span class="nt">&lt;data-column</span> <span class="na">name=</span><span class="s">"datum"</span> <span class="na">type=</span><span class="s">"BINARY"</span> <span class="nt">/&gt;</span>
                  <span class="nt">&lt;timestamp-column</span> <span class="na">name=</span><span class="s">"version"</span> <span class="na">type=</span><span class="s">"BIGINT"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;/binary-keyed-table&gt;</span>
               <span class="nt">&lt;string-keyed-table</span> <span class="na">prefix=</span><span class="s">"ISPN_MIX_STR"</span> <span class="na">create-on-start=</span><span class="s">"true"</span> <span class="na">drop-on-exit=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;id-column</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
                  <span class="nt">&lt;data-column</span> <span class="na">name=</span><span class="s">"datum"</span> <span class="na">type=</span><span class="s">"BINARY"</span> <span class="nt">/&gt;</span>
                  <span class="nt">&lt;timestamp-column</span> <span class="na">name=</span><span class="s">"version"</span> <span class="na">type=</span><span class="s">"BIGINT"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;/string-keyed-table&gt;</span>
            <span class="nt">&lt;/mixed-keyed-jdbc-store&gt;</span>
         <span class="nt">&lt;/local-cache&gt;</span>
      <span class="nt">&lt;/cache-container&gt;</span>
      <span class="nt">&lt;cache-container</span> <span class="na">name=</span><span class="s">"security"</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/subsystem&gt;</span>
	 ...
<span class="nt">&lt;/server&gt;</span></code></pre></figure>

<h2>Launch H2 data base</h2>

<p>Download H2 data base here : <br> <a href="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/h2database/h2-2012-07-13.zip">
	https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/h2database/h2-2012-07-13.zip
</a>
</p>

<p>Run the database with the following parameters</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">java <span class="nt">-cp</span> h2<span class="k">*</span>.jar org.h2.tools.Server <span class="nt">-tcp</span> <span class="nt">-tcpAllowOthers</span> <span class="nt">-tcpPort</span> 8942 <span class="nt">-baseDir</span> ./h2dbstore <span class="nt">-web</span> <span class="nt">-webAllowOthers</span> <span class="nt">-webPort</span> 11112</code></pre></figure>

<p>Now we can start the JBoss Data Grid Server by going to its installation folder and running : </p>
<pre>bin/standalone.sh</pre>

<h2>Create a model class for events and annotate for indexing</h2>

<p>Create a class and annotate it so that it is indexed by Data Grid. To enable indexing through Hot Rod, POJOs need to serialized as protocol buffers</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">techlab.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.infinispan.protostream.annotations.ProtoDoc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.protostream.annotations.ProtoField</span><span class="o">;</span>

<span class="nd">@ProtoDoc</span><span class="o">(</span><span class="s">"@Indexed"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="kd">implements</span> <span class="nc">Serializable</span><span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">uid</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">timestmp</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

	<span class="nd">@ProtoField</span><span class="o">(</span><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUid</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">uid</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUid</span><span class="o">(</span><span class="nc">String</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">uid</span> <span class="o">=</span> <span class="n">uid</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@ProtoDoc</span><span class="o">(</span><span class="s">"@IndexedField(index = true, store = false)"</span><span class="o">)</span>
	<span class="nd">@ProtoField</span><span class="o">(</span><span class="n">number</span> <span class="o">=</span> <span class="mi">2</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Date</span> <span class="nf">getTimestmp</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">timestmp</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTimestmp</span><span class="o">(</span><span class="nc">Date</span> <span class="n">timestmp</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">timestmp</span> <span class="o">=</span> <span class="n">timestmp</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@ProtoDoc</span><span class="o">(</span><span class="s">"@IndexedField(index = true, store = false)"</span><span class="o">)</span>
	<span class="nd">@ProtoField</span><span class="o">(</span><span class="n">number</span> <span class="o">=</span> <span class="mi">3</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@ProtoField</span><span class="o">(</span><span class="n">number</span> <span class="o">=</span> <span class="mi">4</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2>Create rest services to get and put entries into the cache</h2>

<p>Write a CacheManager factory.
	Note that protobuf schemas can be generated from the annotated class and then registered to the Data Grid Server on the reserved in metadata cache</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">techlab.factory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.infinispan.client.hotrod.RemoteCache</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.client.hotrod.RemoteCacheManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.client.hotrod.marshall.ProtoStreamMarshaller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.protostream.SerializationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.protostream.annotations.ProtoSchemaBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.protostream.annotations.ProtoSchemaBuilderException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.query.remote.client.ProtobufMetadataManagerConstants</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">techlab.model.Event</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RemoteCacheManagerFactory</span> <span class="o">{</span>

	<span class="nc">ConfigurationBuilder</span> <span class="n">clientBuilder</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">RemoteCacheManagerFactory</span><span class="o">(</span><span class="nc">String</span> <span class="n">hostname</span><span class="o">,</span> <span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">clientBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConfigurationBuilder</span><span class="o">();</span>
		<span class="n">clientBuilder</span><span class="o">.</span><span class="na">addServer</span><span class="o">()</span>
		<span class="o">.</span><span class="na">host</span><span class="o">(</span><span class="n">hostname</span><span class="o">)</span>
		<span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="n">port</span><span class="o">)</span>
		<span class="o">.</span><span class="na">marshaller</span><span class="o">(</span><span class="k">new</span> <span class="nc">ProtoStreamMarshaller</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">RemoteCacheManager</span> <span class="nf">newRemoteCacheManager</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ProtoSchemaBuilderException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
		<span class="nc">RemoteCacheManager</span> <span class="n">remoteCacheManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RemoteCacheManager</span><span class="o">(</span><span class="n">clientBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>

		<span class="nc">SerializationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="nc">ProtoStreamMarshaller</span><span class="o">.</span><span class="na">getSerializationContext</span><span class="o">(</span><span class="n">remoteCacheManager</span><span class="o">);</span>

		<span class="nc">ProtoSchemaBuilder</span> <span class="n">protoSchemaBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProtoSchemaBuilder</span><span class="o">();</span>

		<span class="c1">//create a protobuf schema file from the annotated class. Protobuf marshallers and unmarshallers are generated automtically</span>
		<span class="nc">String</span> <span class="n">eventSchema</span> <span class="o">=</span> <span class="n">protoSchemaBuilder</span>
				<span class="o">.</span><span class="na">fileName</span><span class="o">(</span><span class="s">"event.proto"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">packageName</span><span class="o">(</span><span class="s">"techlab"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="nc">Event</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
				<span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>

		<span class="c1">//register the protobuf schema in the remote cache</span>
		<span class="nc">RemoteCache</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">metadataCache</span> <span class="o">=</span> <span class="n">remoteCacheManager</span><span class="o">.</span><span class="na">getCache</span><span class="o">(</span><span class="nc">ProtobufMetadataManagerConstants</span><span class="o">.</span><span class="na">PROTOBUF_METADATA_CACHE_NAME</span><span class="o">);</span>
		<span class="n">metadataCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"event.proto"</span><span class="o">,</span> <span class="n">eventSchema</span><span class="o">);</span>

		<span class="c1">//check if there is an error with the schemas</span>
		<span class="nc">String</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">metadataCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">ProtobufMetadataManagerConstants</span><span class="o">.</span><span class="na">ERRORS_KEY_SUFFIX</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">errors</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"Some Protobuf schema files contain errors:\n"</span> <span class="o">+</span> <span class="n">errors</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="n">remoteCacheManager</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Configure the factory in the spring context</p>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;beans&gt;</span>
	...
	<span class="c">&lt;!-- ########################################################### --&gt;</span>
	<span class="c">&lt;!-- Definition of remote cache Manager --&gt;</span>
	<span class="c">&lt;!-- ########################################################### --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"techlab.factory.RemoteCacheManagerFactory"</span> <span class="na">id=</span><span class="s">"remoteCacheManagerFactory"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">"localhost"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">"11222"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">factory-bean=</span><span class="s">"remoteCacheManagerFactory"</span> <span class="na">factory-method=</span><span class="s">"newRemoteCacheManager"</span>
		<span class="na">id=</span><span class="s">"cacheManager"</span> <span class="nt">/&gt;</span>
	...
<span class="nt">&lt;/bean&gt;</span></code></pre></figure>

<p>Add a reusable endpoint to the Camel context</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;camelContext</span> <span class="na">id=</span><span class="s">"techlab-fuse-jdg-library-mode"</span> <span class="na">xmlns=</span><span class="s">"http://camel.apache.org/schema/spring"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- Data Grid endpoint --&gt;</span>
	<span class="nt">&lt;endpoint</span> <span class="na">id=</span><span class="s">"datagrid"</span> <span class="na">uri=</span><span class="s">"infinispan://?cacheContainer=#cacheManager"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/camelContext&gt;</span></code></pre></figure>

<p>Use the rest DSL to create routes and expose services to do the basic operations</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;camelContext</span> <span class="na">id=</span><span class="s">"techlab-fuse-jdg-library-mode"</span> <span class="na">xmlns=</span><span class="s">"http://camel.apache.org/schema/spring"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- Data Grid endpoint --&gt;</span>
	<span class="nt">&lt;endpoint</span> <span class="na">id=</span><span class="s">"datagrid"</span> <span class="na">uri=</span><span class="s">"infinispan://?cacheContainer=#cacheManager"</span> <span class="nt">/&gt;</span>

	<span class="nt">&lt;restConfiguration</span> <span class="na">bindingMode=</span><span class="s">"json"</span> <span class="na">component=</span><span class="s">"netty4-http"</span>
		<span class="na">enableCORS=</span><span class="s">"true"</span> <span class="na">port=</span><span class="s">"7123"</span> <span class="na">apiContextPath=</span><span class="s">"/api-doc"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;dataFormatProperty</span> <span class="na">key=</span><span class="s">"prettyPrint"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/restConfiguration&gt;</span>

	<span class="nt">&lt;rest</span> <span class="na">id=</span><span class="s">"svc"</span> <span class="na">path=</span><span class="s">""</span><span class="nt">&gt;</span>
		<span class="nt">&lt;get</span> <span class="na">id=</span><span class="s">"getOp"</span> <span class="na">uri=</span><span class="s">"{cacheName}/{uid}"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;description&gt;</span>Get an entry with an ID from a cache<span class="nt">&lt;/description&gt;</span>
			<span class="nt">&lt;to</span> <span class="na">uri=</span><span class="s">"direct:getOp"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/get&gt;</span>
		<span class="nt">&lt;put</span> <span class="na">id=</span><span class="s">"putOp"</span> <span class="na">uri=</span><span class="s">"{cacheName}/{uid}"</span> <span class="na">type=</span><span class="s">"techlab.model.Event"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;description&gt;</span>Inserts an entry with the given ID and content in a cache<span class="nt">&lt;/description&gt;</span>
			<span class="nt">&lt;to</span> <span class="na">uri=</span><span class="s">"direct:putOp"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/put&gt;</span>
	<span class="nt">&lt;/rest&gt;</span>

	<span class="c">&lt;!-- rest service to get an entry with the key --&gt;</span>
	<span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"getOpRoute"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;from</span> <span class="na">id=</span><span class="s">"getOpStarter"</span> <span class="na">uri=</span><span class="s">"direct:getOp"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanKey"</span> <span class="na">id=</span><span class="s">"getOpRouteSetKey"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${headers.uid}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanCacheName"</span> <span class="na">id=</span><span class="s">"getOpRouteSetCacheName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${headers.cacheName}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanOperation"</span> <span class="na">id=</span><span class="s">"getOpRouteSetOperation"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;constant&gt;</span>CamelInfinispanOperationGet<span class="nt">&lt;/constant&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;to</span> <span class="na">id=</span><span class="s">"getOpRouteToDataGrid"</span> <span class="na">uri=</span><span class="s">"ref:datagrid"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;setBody</span> <span class="na">id=</span><span class="s">"getOpRouteSetResponse"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${header.CamelInfinispanOperationResult}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setBody&gt;</span>
	<span class="nt">&lt;/route&gt;</span>

	<span class="c">&lt;!-- rest service to put entries into a cache --&gt;</span>
	<span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"putOpRoute"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;from</span> <span class="na">id=</span><span class="s">"putOpStarter"</span> <span class="na">uri=</span><span class="s">"direct:putOp"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanKey"</span> <span class="na">id=</span><span class="s">"putOpRouteSetKey"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${headers.uid}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanCacheName"</span> <span class="na">id=</span><span class="s">"putOpRouteSetCacheName"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${headers.cacheName}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanOperation"</span> <span class="na">id=</span><span class="s">"putOpRouteSetOperation"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;constant&gt;</span>CamelInfinispanOperationPut<span class="nt">&lt;/constant&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanValue"</span> <span class="na">id=</span><span class="s">"putOpRouteSetValue"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>${body}<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setHeader&gt;</span>
		<span class="nt">&lt;to</span> <span class="na">id=</span><span class="s">"putOpRouteToDataGrid"</span> <span class="na">uri=</span><span class="s">"ref:datagrid"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;setBody</span> <span class="na">id=</span><span class="s">"putOpRouteSetResponse"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;simple&gt;</span>Value inserted<span class="nt">&lt;/simple&gt;</span>
		<span class="nt">&lt;/setBody&gt;</span>
	<span class="nt">&lt;/route&gt;</span>
<span class="nt">&lt;/camelContext&gt;</span></code></pre></figure>

<h2>Create a query service with dynamic parameters</h2>

<p>Define a rest service that allows to pass any http query parameters
	<br>(i.e http://localhost:7123/query/event/techlab.model.Event?timestmp=1462208399999&name=ended)</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;get</span> <span class="na">id=</span><span class="s">"queryOp"</span> <span class="na">uri=</span><span class="s">"query/{cacheName}/{type}"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;description&gt;</span>Allows to query based on object fields using lucene search engine<span class="nt">&lt;/description&gt;</span>
	<span class="nt">&lt;to</span> <span class="na">uri=</span><span class="s">"direct:queryOp"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/get&gt;</span></code></pre></figure>

<p>Create classes that generate Data Grid Queries. Note that these classes are pretty generic as they use reflection and are suitable to any data model.
</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">techlab.dg</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.beans.BeanInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.beans.IntrospectionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.beans.Introspector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.beans.PropertyDescriptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.camel.component.infinispan.InfinispanQueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.query.dsl.FilterConditionContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.query.dsl.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.query.dsl.QueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.infinispan.query.dsl.QueryFactory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericQuery</span> <span class="kd">implements</span> <span class="nc">InfinispanQueryBuilder</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">BeanInfo</span> <span class="n">info</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Class</span> <span class="n">type</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">GenericQuery</span><span class="o">(</span><span class="nc">String</span> <span class="n">typeName</span><span class="o">,</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ClassNotFoundException</span><span class="o">,</span> <span class="nc">IntrospectionException</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>

		<span class="c1">//inspect the searched class in order to get the fields that can be queried</span>
		<span class="n">type</span>  <span class="o">=</span>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">typeName</span><span class="o">);</span>
		<span class="n">info</span> <span class="o">=</span> <span class="nc">Introspector</span><span class="o">.</span><span class="na">getBeanInfo</span><span class="o">(</span> <span class="n">type</span><span class="o">,</span><span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Query</span> <span class="nf">build</span><span class="o">(</span><span class="nc">QueryFactory</span><span class="o">&lt;</span><span class="nc">Query</span><span class="o">&gt;</span> <span class="n">queryFactory</span><span class="o">)</span> <span class="o">{</span>


		<span class="nc">QueryBuilder</span><span class="o">&lt;</span><span class="nc">Query</span><span class="o">&gt;</span> <span class="n">qb</span> <span class="o">=</span> <span class="n">queryFactory</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>

		<span class="nc">FilterConditionContext</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>

		<span class="c1">// for each property of the class we look if a parameter has been set</span>
		<span class="k">for</span> <span class="o">(</span> <span class="nc">PropertyDescriptor</span> <span class="n">pd</span> <span class="o">:</span> <span class="n">info</span><span class="o">.</span><span class="na">getPropertyDescriptors</span><span class="o">()</span> <span class="o">){</span>

			<span class="nc">Object</span> <span class="n">searchValue</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">params</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pd</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

			<span class="c1">//only search the fields that are actually indexed by checking the presence of Field annotation</span>

			<span class="c1">//only add search criteria when the parameter has been set in the header and when the property is indexed</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">searchValue</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>

				<span class="c1">//if field is a date convert the type explicitly</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">pd</span><span class="o">.</span><span class="na">getPropertyType</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="nc">Date</span><span class="o">.</span><span class="na">class</span><span class="o">)){</span>
					<span class="n">searchValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span><span class="n">searchValue</span><span class="o">));</span>
				<span class="o">}</span>

				<span class="k">if</span> <span class="o">(</span><span class="n">ctx</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span> 	<span class="c1">//first condition</span>
					<span class="n">ctx</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="na">having</span><span class="o">(</span><span class="n">pd</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">eq</span><span class="o">(</span><span class="n">searchValue</span><span class="o">);</span>
				<span class="o">}</span><span class="k">else</span><span class="o">{</span> 				<span class="c1">//additional conditions with and operator</span>
					<span class="n">ctx</span><span class="o">.</span><span class="na">and</span><span class="o">().</span><span class="na">having</span><span class="o">(</span><span class="n">pd</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">eq</span><span class="o">(</span><span class="n">searchValue</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="n">qb</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">techlab.dg</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.beans.IntrospectionException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.camel.Exchange</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.camel.component.infinispan.InfinispanQueryBuilder</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenerateQuery</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="nc">InfinispanQueryBuilder</span> <span class="nf">getBuilder</span><span class="o">(</span><span class="nc">Exchange</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ClassNotFoundException</span><span class="o">,</span> <span class="nc">IntrospectionException</span> <span class="o">{</span>

		<span class="nc">InfinispanQueryBuilder</span> <span class="n">qb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericQuery</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">),</span><span class="n">ex</span><span class="o">.</span><span class="na">getIn</span><span class="o">().</span><span class="na">getHeaders</span><span class="o">());</span>

		<span class="k">return</span> <span class="n">qb</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Declare the beans, service endpoint and route in the Camel context</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;beans&gt;</span>
	...
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"generateQuery"</span> <span class="na">class=</span><span class="s">"techlab.dg.GenerateQuery"</span> <span class="nt">/&gt;</span>
	...
	<span class="nt">&lt;camelContext</span> <span class="na">id=</span><span class="s">"techlab-fuse-jdg-library-mode"</span> <span class="na">xmlns=</span><span class="s">"http://camel.apache.org/schema/spring"</span><span class="nt">&gt;</span>
		...
		<span class="nt">&lt;rest</span> <span class="na">id=</span><span class="s">"svc"</span> <span class="na">path=</span><span class="s">""</span> <span class="nt">&gt;</span>
			...
			<span class="nt">&lt;get</span> <span class="na">id=</span><span class="s">"queryOp"</span> <span class="na">uri=</span><span class="s">"query/{cacheName}/{type}"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;description&gt;</span>Allows to query based on object fields using lucene search engine<span class="nt">&lt;/description&gt;</span>
				<span class="nt">&lt;to</span> <span class="na">uri=</span><span class="s">"direct:queryOp"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;/get&gt;</span>
		<span class="nt">&lt;/rest&gt;</span>
		...
		<span class="c">&lt;!-- rest service to query caches with any indexed field --&gt;</span>
		<span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">"queryOpRoute"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;from</span> <span class="na">id=</span><span class="s">"queryOpStarter"</span> <span class="na">uri=</span><span class="s">"direct:queryOp"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;log</span> <span class="na">message=</span><span class="s">"Query headers : ${headers}"</span><span class="nt">&gt;&lt;/log&gt;</span>
			<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanCacheName"</span> <span class="na">id=</span><span class="s">"queryOpRouteSetCacheName"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;simple&gt;</span>${headers.cacheName}<span class="nt">&lt;/simple&gt;</span>
			<span class="nt">&lt;/setHeader&gt;</span>
			<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanOperation"</span> <span class="na">id=</span><span class="s">"queryOpRouteSetOperation"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;constant&gt;</span>CamelInfinispanOperationQuery<span class="nt">&lt;/constant&gt;</span>
			<span class="nt">&lt;/setHeader&gt;</span>
			<span class="nt">&lt;setHeader</span> <span class="na">headerName=</span><span class="s">"CamelInfinispanQueryBuilder"</span> <span class="na">id=</span><span class="s">"queryOpRouteSetBuilder"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;method</span> <span class="na">ref=</span><span class="s">"generateQuery"</span> <span class="na">method=</span><span class="s">"getBuilder"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;/setHeader&gt;</span>
			<span class="nt">&lt;to</span> <span class="na">id=</span><span class="s">"queryOpRouteToDataGrid"</span> <span class="na">uri=</span><span class="s">"ref:datagrid"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;setBody</span> <span class="na">id=</span><span class="s">"queryOpRouteSetResponse"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;simple&gt;</span>${header.CamelInfinispanOperationResult}<span class="nt">&lt;/simple&gt;</span>
			<span class="nt">&lt;/setBody&gt;</span>
		<span class="nt">&lt;/route&gt;</span>
	<span class="nt">&lt;/camelContext&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre></figure>

<h2>Test the project</h2>

<p>Run the Fuse project on your developer machine</p>

<pre>mvn clean package camel:run</pre>

<p>Insert a few entries by running a curl command</p>

<pre>
curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
 "uid": "1",
 "timestmp": "2017-04-07T19:30:00.000Z",
 "name": "start",
 "content": "party started" }' 'http://localhost:7123/event/1'

curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
	"uid": "2",
	"timestmp": "2017-04-07T22:15:00.000Z",
	"name": "incident",
	"content": "police arrived" }' 'http://localhost:7123/event/2'

curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
	"uid": "3",
	"timestmp": "2017-04-07T23:18:00.000Z",
	"name": "incident",
	"content": "host arrested" }' 'http://localhost:7123/event/3'

curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
 "uid": "4",
 "timestmp": "2017-04-07T23:20:00.000Z",
 "name": "end",
 "content": "party ended" }' 'http://localhost:7123/event/4'
</pre>

<p>List all events through a query without parameters</p>
<pre>curl -X GET --header 'Accept: application/json' 'http://localhost:7123/query/event/techlab.model.Event'</pre>
<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491593400000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"start"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"party started"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491603300000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"police arrived"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491607080000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"host arrested"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491607200000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"end"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"party ended"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>List all incidents through a query with a parameter</p>
<pre>curl -X GET --header 'Accept: application/json' 'http://localhost:7123/query/event/techlab.model.Event?name=incident'</pre>
<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491603300000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"police arrived"</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491607080000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"host arrested"</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p>List all incidents at a certain hour with 2 parameters</p>
<figure class="highlight"><pre><code class="language-shell" data-lang="shell">curl <span class="nt">-X</span> GET <span class="nt">--header</span> <span class="s1">'Accept: application/json'</span> <span class="s1">'http://localhost:7123/query/event/techlab.model.Event?name=incident&amp;timestmp=1491607080000'</span></code></pre></figure>
<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestmp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1491607080000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"incident"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"host arrested"</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p>Alternatively you can also use swagger-ui to test the services</p>
<ul>
	<li>To test the services you can use swagger-ui to explore the rest services.
		Download swagger-ui : <a href="https://github.com/swagger-api/swagger-ui/archive/v2.2.10.zip">https://github.com/swagger-api/swagger-ui/archive/v2.2.10.zip
		</a></li>
		<li>Unzip the package and open dist/index.html in your favorite browser</li>
		<li>Enter the url of the api-doc : http://localhost:7123/api-doc</li>
</ul>

<a href="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/swagger.png"> <img
	class="center-block img-responsive"
	src="/assets/images//posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/swagger.png" alt="swagger for rest service testing"/></a>


<h2>
Deploy Fuse project to Fuse Server (Karaf)
</h2>

<p>In the pom.xml file of the Fuse project, add dynamic import block to the maven-bundle-plugin.</p>
<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>${version.maven-bundle-plugin}<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
	<span class="nt">&lt;configuration&gt;</span>
		<span class="nt">&lt;instructions&gt;</span>
			<span class="nt">&lt;Bundle-SymbolicName&gt;</span>techlab-fuse-jdg-simple-hotrod<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
			<span class="nt">&lt;Bundle-Name&gt;</span>techlab-fuse-jdg-simple-hotrod<span class="nt">&lt;/Bundle-Name&gt;</span>
			<span class="nt">&lt;DynamicImport-Package&gt;</span>*<span class="nt">&lt;/DynamicImport-Package&gt;</span>
		<span class="nt">&lt;/instructions&gt;</span>
	<span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure>

<p>Generate bundle for deployment</p>

<pre>mvn clean package</pre>

<p>Connect to Fuse console and run these commands to install required dependencies</p>
<pre>
features:install camel-swagger-java camel-netty4-http camel-jackson
features:addurl mvn:org.apache.camel/camel-jbossdatagrid/6.5.1.Final-redhat-1/xml/features
features:install camel-jbossdatagrid
</pre>
<p>Install our Fuse project bundle</p>
<figure class="highlight"><pre><code class="language-shell" data-lang="shell">osgi:install <span class="nt">-s</span> file:&lt;PATH_TO_PROJECT&gt;/techlab-fuse-jdg-simple-hotrod/target/techlab-fuse-jdg-simple-hotrod-1.0.0-SNAPSHOT.jar</code></pre></figure>
<p>That's it, now we have our running Data Grid with persistence, indexes and we are able to access it in a Fuse Project.
</p>

<p>Thanks for reading</p>



	
	<p>Originally published April 07, 2017
    <br> Latest update April 07, 2017</p>

    <p><strong>Related posts :</strong></p>
        <ul>
	    
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  <li>
			      <a href="/posts/faster-fuse-integration-service-s2i-openshift-deployments/">
			        Faster Fuse Integration Service 2.0 S2I Openshift Deployments
			      </a>
			  </li>
			  
		
			  
			  
			  <li>
			      <a href="/posts/handling-large-streams-of-data-through-http-with-jboss-fuse/">
			        Handling Large Streams of Data through HTTP with JBoss Fuse
			      </a>
			  </li>
			  
		
			  
			  
			  <li>
			      <a href="/posts/ansible-automation-for-highly-available-jboss-fuse-amq-integration-platform/">
			        Ansible Automation for Highly Available JBoss Fuse/A-MQ Integration Platform
			      </a>
			  </li>
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
			  
		
		</ul>
	

	
	
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://alainpham.github.io/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries/";  // Replace PAGE_URL with your page's canonical URL variable
//this.page.identifier = "/posts/fuse-data-grid-integration-via-hot-rod-with-persistence-and-indexing-for-advanced-queries"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//apham.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
	</div>
	<footer class="footer">
	<ul class="footer-links">
		<li><a href="http://github.com/alainpham"> <i
				class="fa fa-inverse fa-github fa-3x"></i></a></li>
		<li><a href="http://www.linkedin.com/in/alainpham"> <i
				class="fa fa-inverse fa-linkedin-square fa-3x"></i></a></li>
		<li><a href="https://twitter.com/koint"> <i
				class="fa fa-inverse fa-twitter fa-3x"></i></a></li>
	</ul>
</footer>
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
